课堂笔记之大型主机操作系统基础实验
=====

大型主机系统基础实验的笔记。准备要考试了喔。

1.概述
-----
可靠性、可用性、可服务性：简称**RAS**

初代主机 **System/360** 诞生于**1964**年

z/OS的目标:
1. 多道程序设计 : 同时执行多个程序
2. 多重处理 : 多个处理器同时运行

地址空间:
1. 地址空间隔离 ： 地址空间标识符（ASID）类比于进程ID（PID）
2. 地址空间通信

    1.  调用一个服务请求块（SRB），一个异步过程
    2.  使用交叉内存服务和访问寄存器，一个同步过程

动态地址转换（DAT）是指在存储定位过程中将虚拟地址转换成所对应的实存地址的过程。

三种寻址方式（历史遗留问题）：24位，31位，64位

z/OS监督作业的机制
1. 中断处理
2. 创建作业调度单元
3. 调度任务
4. 串行化系统资源之使用

中断处理中的程序状态字(**PSW**)是处理器中一个128位的数据区.当前PSW包括了下一个程序指令的地址和正在执行的程序的控制信息.每个处理器只有一个当前的PSW.

可抢占VS不可抢占
TCB 任务控制块 在一个地址空间内执行的任务
SRB 服务请求块 在特定地址空间内执行一个特定功能或服务的程序。
SRB是不可抢占的,由TCB表示的程序(比如用户程序)是可抢占的.

调度器队列
地址空间可以存在于以下4个队列的任何一个
* 内就绪队列 - 在中央存储器中,等待调度
* 内等待队列 - 在中央存储器中,但在等待一些事件完成
* 外就绪队列 - 处于执行就绪状态,但已经被换出
* 外等待队列 - 被换成并等待一些事件完成

2.z/OS交互
-----
分配数据集:
* 卷序列号 包含6个字符 为外部存储设备卷名 如USER01
* 设备类型 一个磁盘设备的型号或类型 如3390
* 等等

行命令操作
* I[n] 插入n行
* D[n] 删除n行
* R[n]    重复n行
* C[n] 后面跟着a或b，在之后或之前复制n行
* M[n] 移动n行
* X[n]    隐去n行
* S[n] 显示n行

数据集操作
-----

数据集是包含一个或多个记录的一个文件。可以被编目，编目是指可以通过名称引用数据集而不需要指定存储位置。
记录是包含数据的固定数目的字节。

三种常用数据集： 顺序数据集（PS）、分区数据集（PDS）、VSAM数据集
DSAD卷用来存储数据和可执行程序（包含操作系统本身），以及用于临时工作的存储。
卷标签存储在0号柱面的0号磁道上，用于确定每个DASD卷。

数据集名可以由总长不超过44个字符、22个字段组成。其中第一个字段为高级限定词，最后一个字段是最低级限定词。字段第一个字符必须为字母或{# @ $}，字段间以'.'隔开。

数据集名常见约定从略（看书上的清单）

RECFM 数据集记录格式：
* F 块/记录大小相同 少有
* FB 定长组块 定长记录
* V 变长不组块 逻辑记录即物理块
* VB 变长组块 
* U 无定义

BLKSIZE :
F/FB 物理块大小
其它：可用的物理块的最大空间

LRECL ：
逻辑记录大小
V/VB 允许的逻辑记录大小

分区数据集通过引用指向成员。成员按照字母顺序存于目录之中，但在分区数据集中的成员按照任意顺序排列
缺点：没法重用原成员的空间，必须通过重组来移除浪费的空间。PDS的目录只能存储固定数量的成员条目。

卷内容表（VTOC）是一种包含数据集标签的结构，管理数据集的存储和布置。影响了盘卷里能放的数据集数量。

磁盘或磁带上的数据集都可以被编目。包括下面三个信息：数据集名称、卷名、设备单元。使用目录可以为已经编目的任何数据集提供单元设备类型和卷名。
z/OS使用一个主目录和许多与之关联的用户目录。

世代数据组（GDG）是一些历史相关的非VSAM数据集的集合，这些数据集按时间顺序排序。这个组里每个数据集与其它数据集是历史相关的。

过滤数据集：`*`至少一个限定符 `**`0个或多个限定符 `%`一个字符

数据集编辑
-----

SORT <起始列 结束列 A or D> 排序
FIND 在文档中查找字符串
CHANGE 查找并替换字符串
LOCATE n 前往第n行
CUT PASTE COPY 功能同其名

复制顺序数据集 3.3后选C
移动顺序数据集 3.3后选M

JCL
-----

系统规定JCL语句的长度为80列。逻辑上将这80列分成5个区域，即标识符区、名称区、操作符区、参数区和说明区。
* 标识符区位于前两列，符号为`//`
* 名称区第一个字符必须为字母或通配符。
* 各区间以空格分割

每个作业可以由一个或多个作业步组成。
每个作业必须包含三种JCL语句
1. 作业语句 JOB 
2. 执行语句 EXEC
3. 数据定义语句 DD 提供执行语句中的程序运行所需的输入和输出文件。

例子看书上。具体的不多列举了。

###作业语句

作业语句标志一个作业的开始、指定作业名并设置相关参数

    // JOBNAME JOB NOTIFY=&SYSUID, MSGLEVEL=(1,1)

###执行语句

执行语句标明作业或过程中的每个作业步的开始，告诉系统如何执行这个作业步
需要有PGM参数或PROC参数。
PGM参数用于指明所要执行的程序名
PROC指明作业步所要运行的过程名

    // STEP1 EXEC PGM=IEFBR14
    
###数据定义语句

用于定义一个数据集及该数据集所需输入及输出资源
常见参数如下：
* DSN= 定义数据集名
* DISP= 定义数据集部署 格式 (status, success, fail)

    * status : 对数据集的动作
        * NEW : 新建
        * OLD : 每个作业独占
        * SHR : 每个作业共享
        * MOD : 当前作业独享
    * normal end / abnormal end : 处理成功/失败后的返回
        * DELETE : 删除并取消编目
        * KEEP : 保留不编目
        * CATLG : 保留编目
        * UNCATLG : 保留取消编目
        * PASS : 交由下面的作业步决定
* SPACE= 所需的存储空间 如 (TRK,(10, 5)) 初次分配10个磁道，每次拓展分配5个磁道
* SYSOUT= 定义打印位置
* VOL=SER= 设定卷名、磁盘名、磁带名
* UNIT= 设定系统磁盘、磁带、其他设备类型
* DEST= 将输出发到远程目的地
* LRECL= 逻辑记录长度
* RECFM= 记录格式 定长 组块 变长
* BLOCKSIZE= 记录块大小 LRECL倍数
* DSORG= 数据集类型
* LABEL= 预期的磁带标签
* DUMMY= 导致空输入或舍弃写在ddname上的数据
*  `*` : 后面接输入数据或控制语句

### 续行要求

前一行参数写完整 然后后面加逗号
下一行 `//`开头，后面留至少一个空格
续行内容必须在第16列或之后开始，不得超过72列

###SDSF

ST下使用`PREFIX *`等进行过滤作业
ST下在作业号左边输入P（居然）可以删除
使用DA显示所有活动的作业

###作业控制子系统

可定制为JES2或JES3
在单处理器下差别不大
多处理器下：
只有JES3提供了全局处理器来实现调度

###作业处理流程

1. 输入
2. 转换
3. 处理
4. 输出
5. 硬拷贝/打印
6. 清除

###系统库

SYS1.PROCLIB z/OS发布的JCL过程
SYS1.PARMLIB z/OS和一些程序的控制参数
SYS1.LINKLIB 许多系统的基本执行模块。

实用程序
---

IEFBR14  提供内容为0的返回码
IEBGENER 可以将一个顺序数据集内容复制到另一个数据集中。
IEBCOPY  将一个分区数据集中选定的（或所有的）成员复制到另一个分区数据集中。
IEBDG 创建记录，该记录的域可以用各种类型的数据填充。创建测试数据。
IEBUPDTE 在一个分区数据集中创建多个成员，或更新一个成员的记录。

VSAM
-----

CI(control interval)由一个或多个物理记录组成，是VSAM文件的基本组成块。

CA(control area)是由两个或以上CI组成的一块区域。

###VSAM组件

1. 数据组件：用以存放数据记录
2. 索引组件：只有KSDS和RRDS VSAM数据集才会使用索引组件

一个VSAM文件中会包含数据组件和索引组件。但在用户眼里只有一个VSAM，这就是簇群(cluster)的作用。

###定位数据记录

* 键值域
* 相对字节地址
* 相对记录数

###种类

1. KSDS 以键值的升序存放。该记录的键值不能改变。插入新纪录也是按升序排列的
2. ESDS 按照先来后到排序，不需要索引组件。可以顺序访问或通过RBA直接访问
3. LDS 在CI中没有嵌入的控制信息。所有的域都是数据。其逻辑记录必须通过应用程序来分块
4. RRDS 只能用于定长的数据集，包含多个预定的定长的孔，每个孔有一个唯一的相对记录数。按升序排列

###ditto

主界面使用`du`打开打开ditto界面。具体行操作等同于一般的编辑界面。
